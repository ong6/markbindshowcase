<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="generator" content="MarkBind 3.1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <link rel="stylesheet" href="../markbind/css/bootstrap.min.css">
    <link rel="stylesheet" href="../markbind/css/bootstrap-vue.min.css">
    <link rel="stylesheet" href="../markbind/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="../markbind/glyphicons/css/bootstrap-glyphicons.min.css">
    <link rel="stylesheet" href="../markbind/css/octicons.css">
    <link rel="stylesheet" href="../markbind/material-icons/material-icons.css">
    <link rel="stylesheet" href="../markbind/css/codeblock-dark.min.css"><link rel="stylesheet" href="../markbind/css/markbind.min.css"><script src="../markbind/js/polyfill.min.js"></script>
    <script src="../markbind/js/vue.min.js"></script>
    <script src="../markbind/js/markbind.min.js"></script>
    <script src="data-migration.page-vue-render.js"></script>
    <script src="../markbind/js/jquery.min.js"></script><link rel="stylesheet" href="/markbindshowcase/plugins/markbind-plugin-anchors/markbind-plugin-anchors.css">
    
  <link rel="stylesheet" href="/markbindshowcase/stylesheets/main.css">
</head>
<script>
  const baseUrl = '/markbindshowcase'
</script>
<body  data-spy="scroll" data-target="#mb-page-nav" data-offset="100" >
<div id="app" data-server-rendered="true"><header fixed=""><div placement="top" data-v-15113a2f><nav class="navbar navbar-expand-md navbar-dark bg-primary" data-v-15113a2f><div class="container-fluid" data-v-15113a2f><div class="navbar-left" data-v-15113a2f><a href="/index.html" title="Home" class="navbar-brand" data-v-15113a2f><i class="far fa-file-image" data-v-15113a2f></i></a></div> <div class="navbar-default" data-v-15113a2f><ul class="navbar-nav mr-auto mt-2 mt-lg-0" data-v-15113a2f> <li data-v-15113a2f><a href="/index.html" class="nav-link" data-v-15113a2f>HOME</a></li> <li data-v-15113a2f><a href="/about.html" class="nav-link" data-v-15113a2f>ABOUT</a></li></ul></div> <ul class="navbar-nav navbar-right" data-v-15113a2f><li data-v-15113a2f><form class="navbar-form" data-v-15113a2f><div style="position:relative;"><input type="text" placeholder="Search" autocomplete="off" value="" class="form-control"> <ul class="dropdown-menu search-dropdown-menu dropdown-menu-right"></ul></div></form></li></ul></div></nav> <div class="lower-navbar-container" style="display:none;" data-v-15113a2f><!----> <!----></div></div></header> <div id="flex-body"><nav id="site-nav" class="fixed-header-padding" data-v-e8c82f88><div class="site-nav-top" data-v-e8c82f88><div class="font-weight-bold mb-2" style="font-size:1.25rem;" data-v-e8c82f88>Template</div></div> <div class="nav-component slim-scroll" data-v-e8c82f88><div class="site-nav-root"><ul class="site-nav-list site-nav-list-root" data-v-e8c82f88><li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/CONTRIBUTING.html" data-v-e8c82f88>CONTRIBUTING</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/README.html" data-v-e8c82f88>README</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/about.html" data-v-e8c82f88>About</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/best-practices%5Ccoding.html" data-v-e8c82f88>Coding</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/best-practices%5Cdata-migration.html" data-v-e8c82f88>Data Migration</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/best-practices%5Ctesting.html" data-v-e8c82f88>Testing</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/best-practices%5Cui-design.html" data-v-e8c82f88>Ui Design</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/captcha.html" data-v-e8c82f88>Captcha</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/contents%5Ctopic1.html" data-v-e8c82f88>Topic 1</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/contents%5Ctopic2.html" data-v-e8c82f88>Topic 2</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/contents%5Ctopic3a.html" data-v-e8c82f88>Topic 3 A</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/contents%5Ctopic3b.html" data-v-e8c82f88>Topic 3 B</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/design.html" data-v-e8c82f88>Design</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/development.html" data-v-e8c82f88>Development</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/e2e-testing.html" data-v-e8c82f88>E 2 E Testing</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/emails.html" data-v-e8c82f88>Emails</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/glossary.html" data-v-e8c82f88>Glossary</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/index.html" data-v-e8c82f88>Index</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/issues.html" data-v-e8c82f88>Issues</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/overview.html" data-v-e8c82f88>Overview</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/performance-testing.html" data-v-e8c82f88>Performance Testing</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/process.html" data-v-e8c82f88>Process</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/search.html" data-v-e8c82f88>Search</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/setting-up.html" data-v-e8c82f88>Setting Up</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/snapshot-testing.html" data-v-e8c82f88>Snapshot Testing</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/static-analysis.html" data-v-e8c82f88>Static Analysis</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/markbindshowcase/troubleshooting-guide.html" data-v-e8c82f88>Troubleshooting Guide</a></div></li> <!----></ul></div></div> <!----></nav> <div id="content-wrapper" class="fixed-header-padding"><h1 id="data-migration-best-practices"><span id="data-migration-best-practices" class="anchor"></span>Data Migration Best Practices<a href="#data-migration-best-practices" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h1> <p>Data migration is necessary when a new, possibly backwards-incompatible, schema
is introduced in the code base.</p> <ul><li><a href="#data-migration-best-practices">Data Migration Best Practices</a> <ul><li><a href="#making-code-work-for-both-schemas">Making code work for both schemas</a></li> <li><a href="#interchangeability-between-consecutive-versions">Interchangeability between consecutive versions</a></li></ul></li></ul> <h2 id="making-code-work-for-both-schemas"><span id="making-code-work-for-both-schemas" class="anchor"></span>Making code work for both schemas<a href="#making-code-work-for-both-schemas" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h2> <p>Initially, the breaking change should be written such that it works for both the
old data schema and the new data schema. This can be done in two ways:</p> <ul><li><p>Using
<a href="https://github.com/objectify/objectify/wiki/LifecycleCallbacks">Objectify lifecycle annotation <code class="hljs inline no-lang">@OnLoad</code></a></p> <ul><li>In this lifecycle call, one could convert data in the old schema to the new
schema.</li> <li>However, it would be difficult to write client script to migrate the old
schema to the new schema as all entities loaded by Objectify in the client
script will be in new data schema because of the lifecycle call. Therefore,
it is hard to differentiate the data in old schema and the data in new
schema.</li></ul></li> <li><p>Using Getter and Setter</p> <ul><li>This is the <strong>recommended</strong> way to convert data from the old schema to the
new schema. It allows you to storage data in the new schema without knowing
the underlying data schema.</li> <li>In doing this, data migration script can use Java Reflection to determine
whether it is old data or not and convert it accordingly.</li></ul></li></ul> <h2 id="interchangeability-between-consecutive-versions"><span id="interchangeability-between-consecutive-versions" class="anchor"></span>Interchangeability between consecutive versions<a href="#interchangeability-between-consecutive-versions" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h2> <p>It is undeniable that the version using old data schema should be
interchangeable with the immediate next version using the new data schema. This
is why it is important to write code that works for both schemas.</p> <p>In addition, it is also important to make sure the code work for both the
version tailored for the old data schema and the <strong>immediate</strong> next version
without hacks of the old schema.</p> <p>For example, a field <code class="hljs inline no-lang">isInNewDataSchema</code> is introduced to take care of the old
schema. It will be imprudent to remove the field in the immediate next version
after the client script is run as all data generated by the new version will
have this field missing and be <em>wrongly</em> treated as data in old schema in the
old version. In the immediate next version, the field should be marked to <code class="hljs inline no-lang">true</code>
although it has no usage. In the version after the immediate next version, the
field can be safely removed. That is, we should make any two consecutive
versions interchangeable at <strong>ALL</strong> times.</p> <i id="scroll-top-button" onclick="handleScrollTop()" aria-hidden="true" class="fa fa-arrow-circle-up fa-lg d-print-none"></i></div> <nav id="page-nav" class="fixed-header-padding" data-v-e8c82f88><div class="nav-component slim-scroll" data-v-e8c82f88><a href="#" class="navbar-brand page-nav-title" data-v-e8c82f88>Chapters of This Page</a> <nav id="mb-page-nav" class="nav nav-pills flex-column my-0 small no-flex-wrap" data-v-e8c82f88><a href="#data-migration-best-practices" class="nav-link py-1" data-v-e8c82f88>Data Migration Best Practices‎</a> <nav class="nav nav-pills flex-column my-0 nested no-flex-wrap" data-v-e8c82f88><a href="#making-code-work-for-both-schemas" class="nav-link py-1" data-v-e8c82f88>Making code work for both schemas‎</a> <a href="#interchangeability-between-consecutive-versions" class="nav-link py-1" data-v-e8c82f88>Interchangeability between consecutive versions‎</a></nav> <!----></nav></div> <!----></nav></div> <footer><div class="text-center"><small>[Generated by ]</small></div></footer></div>
</body><script src="../markbind/js/bootstrap-utility.min.js"></script>
<script>
  MarkBind.setupWithSearch()
</script>
</html>
